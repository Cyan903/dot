workspace "Media"

input {
    keyboard {
        xkb {}
        numlock
    }

    touchpad {
        tap
        natural-scroll
    }

    mouse {
        accel-speed 0.15
        accel-profile "flat"
    }

    trackball {
        accel-speed 0.5
        accel-profile "flat"
    }

    focus-follows-mouse max-scroll-amount="25%"

    // Disabled
    // warp-mouse-to-focus mode="center-xy"
}

// Main monitor
output "HDMI-A-1" {
    mode "1920x1080@143.981"
    scale 1
    transform "normal"
    position x=1920 y=1080
    backdrop-color "#000000" // {< replace_color(data.colors.background) >}

    layout {
        background-color "#000000" // {< replace_color(data.colors.wallpaper) >}
    }

    focus-at-startup
}

// Left
output "DP-2" {
    mode "1920x1080@165.001"
    scale 1
    transform "normal"
    position x=0 y=1080
    backdrop-color "#000000" // {< replace_color(data.colors.background) >}

    layout {
        background-color "#000000" // {< replace_color(data.colors.wallpaper) >}
    }
}

// TV
output "DP-3" {
    mode "1680x1050@59.883"
    scale 1
    transform "normal"
    position x=2250 y=30
    backdrop-color "#000000" // {< replace_color(data.colors.background) >}

    layout {
        background-color "#000000" // {< replace_color(data.colors.wallpaper) >}
    }
}

// Bed
output "DP-1" {
    mode "1920x1080@60.000"
    scale 1.2
    transform "normal"
    position x=3840 y=1080
    backdrop-color "#000000" // {< replace_color(data.colors.background) >}

    layout {
        background-color "#000000" // {< replace_color(data.colors.wallpaper) >}
    }
}

layout {
    gaps 4

    // never, always, on-overflow
    center-focused-column "on-overflow"
    default-column-width { proportion 0.5; }

    preset-column-widths {
        proportion 0.33333
        proportion 0.5
        proportion 0.66667
    }

    preset-window-heights {
        proportion 0.33333
        proportion 0.5
        proportion 0.66667
    }

    focus-ring {
        off
        width 2
        active-color "#5C5CFF" // {< replace_color(data.colors.primary) >}
        inactive-color "#000000" // {< replace_color(data.colors.wallpaper) >}
    }

    border {
        width 2
        active-color "#5C5CFF" // {< replace_color(data.colors.primary) >}
        inactive-color "#1C1C1C" // {< replace_color(data.colors.black) >}
        urgent-color "#FFFFFF" // {< replace_color(data.colors.foreground) >}
    }

    shadow {
        on
        softness 20
        spread 1
        offset x=0 y=5
        color "#000000"
    }

    struts {
        left 20
        right 20
        top 5
        bottom 5
    }
}

animations {
    // off
    slowdown 0.8
}

binds {
    // wev | grep sym
    Mod+Shift+Slash { show-hotkey-overlay; }


    // Audio
    Mod+Equal hotkey-overlay-title="Volume: +10%" allow-when-locked=true { spawn "wpctl" "set-volume" "@DEFAULT_AUDIO_SINK@" "0.1+"; }
    Mod+Minus hotkey-overlay-title="Volume: -10%" allow-when-locked=true { spawn "wpctl" "set-volume" "@DEFAULT_AUDIO_SINK@" "0.1-"; }
    Mod+Shift+Equal hotkey-overlay-title="Volume: +5%" allow-when-locked=true { spawn "wpctl" "set-volume" "@DEFAULT_AUDIO_SINK@" "0.05+"; }
    Mod+Shift+Minus hotkey-overlay-title="Volume: -5%" allow-when-locked=true { spawn "wpctl" "set-volume" "@DEFAULT_AUDIO_SINK@" "0.05-"; }



    // Music/Video
    Mod+Ctrl+Equal hotkey-overlay-title="Music: Next" repeat=false { spawn "yt-music" "next"; }
    Mod+Ctrl+Minus hotkey-overlay-title="Music: Previous" repeat=false { spawn "yt-music" "prev"; }
    Mod+Ctrl+Backspace hotkey-overlay-title="Music: Toggle" repeat=false { spawn "yt-music" "toggle"; }

    Mod+Ctrl+Alt+Equal hotkey-overlay-title="Video: Next" repeat=false { spawn "mpv-cli" "next"; }
    Mod+Ctrl+Alt+Minus hotkey-overlay-title="Video: Previous" repeat=false { spawn "mpv-cli" "prev"; }
    Mod+Ctrl+Alt+Backspace hotkey-overlay-title="Video: Toggle" repeat=false { spawn "mpv-cli" "toggle"; }


    // Keyboard
    Mod+Shift+Escape hotkey-overlay-title="Keyboard: Toggle floating keyboard" repeat=false { spawn "onscreen-keyboard" "toggle"; }


    // Launcher
    Mod+Return hotkey-overlay-title="Launcher: Alacritty" repeat=false { spawn "alacritty"; }
    Mod+Backslash hotkey-overlay-title="Launcher: Librewolf" repeat=false { spawn "librewolf"; }
    Mod+Shift+Backslash hotkey-overlay-title="Launcher: Chromium" repeat=false { spawn "chromium" "--incognito" "--enable-features=UseOzonePlatform" "--ozone-platform=wayland"; }
    Mod+Backspace hotkey-overlay-title="Launcher: File manager" repeat=false { spawn "pcmanfm"; }
    Mod+Shift+S hotkey-overlay-title="Launcher: ocr-shot" { spawn "ocr-shot"; }

    Mod+F hotkey-overlay-title="Launcher: Find application" repeat=false { spawn "rofi-toggle" "-disable-history" "-show" "drun"; }
    Mod+Shift+F hotkey-overlay-title="Launcher: Run application" repeat=false { spawn "rofi-toggle" "-disable-history" "-show" "run"; }
    Mod+W hotkey-overlay-title="Launcher: Find window" repeat=false { spawn "rofi-toggle" "-disable-history" "-show" "window"; }
    Mod+B hotkey-overlay-title="Launcher: Show bookmarks" repeat=false { spawn "bookmark" "show" "menu"; }
    Mod+Ctrl+c hotkey-overlay-title="Launcher: Show SMB" repeat=false { spawn "smb-gui"; }


    // Scripts
    Mod+Grave { spawn "~/.config/niri/bin/media-tab"; }
    Mod+Ctrl+Shift+x repeat=false { spawn "~/.config/niri/bin/kill-focused"; }


    // Waybar: Scripts
    Mod+Alt+M hotkey-overlay-title="Volume: Mute toggle" allow-when-locked=true { spawn "~/.config/waybar/ext/mute-toggle"; }
    Mod+Semicolon hotkey-overlay-title="Brightness: Down" { spawn "~/.config/waybar/ext/dim-toggle" "up"; }
    Mod+Apostrophe hotkey-overlay-title="Brightness: Up" { spawn "~/.config/waybar/ext/dim-toggle" "down"; }
    Mod+Shift+Apostrophe hotkey-overlay-title="Brightness: Reset" { spawn "~/.config/waybar/ext/dim-toggle" "stop"; }


    // XF86: Audio
    XF86AudioRaiseVolume { spawn "wpctl" "set-volume" "@DEFAULT_AUDIO_SINK@" "0.1+"; }
    XF86AudioLowerVolume { spawn "wpctl" "set-volume" "@DEFAULT_AUDIO_SINK@" "0.1-"; }
    XF86AudioMute allow-when-locked=true { spawn "wpctl" "set-mute" "@DEFAULT_AUDIO_SINK@" "toggle"; }


    // XF86: Scripts
    XF86AudioPlay repeat=false { spawn "~/.config/niri/bin/media" "toggle"; }


    // XF86: Waybar
    XF86AudioMicMute allow-when-locked=true { spawn "~/.config/waybar/ext/mute-toggle"; }
    Shift+XF86AudioMute allow-when-locked=true { spawn "~/.config/waybar/ext/mute-toggle"; }


    // Dynamic binds
    Mod+F1 { spawn "~/.config/niri/bin/dynamic-binds" "F1"; }
    Mod+F2 { spawn "~/.config/niri/bin/dynamic-binds" "F2"; }
    Mod+F3 { spawn "~/.config/niri/bin/dynamic-binds" "F3"; }
    Mod+F4 { spawn "~/.config/niri/bin/dynamic-binds" "F4"; }
    Mod+F6 { spawn "~/.config/niri/bin/dynamic-binds" "F6"; }
    Mod+F7 { spawn "~/.config/niri/bin/dynamic-binds" "F7"; }
    Mod+F9 { spawn "~/.config/niri/bin/dynamic-binds" "F9"; }
    Mod+F10 { spawn "~/.config/niri/bin/dynamic-binds" "F10"; }
    Mod+F11 { spawn "~/.config/niri/bin/dynamic-binds" "F11"; }
    Mod+F12 { spawn "~/.config/niri/bin/dynamic-binds" "F12"; }


    // Client
    Mod+O hotkey-overlay-title="Client: Toggle overview" repeat=false { toggle-overview; }
    Mod+Shift+C hotkey-overlay-title="Client: Close window" { close-window; }


    // Client: Focus
    Mod+H hotkey-overlay-title="Client: Focus left" { focus-column-left; }
    Mod+J hotkey-overlay-title="Client: Focus down" { focus-window-or-workspace-down; }
    Mod+K hotkey-overlay-title="Client: Focus up" { focus-window-or-workspace-up; }
    Mod+L hotkey-overlay-title="Client: Focus right" { focus-column-right; }

    /*
     * Mod+Left hotkey-overlay-title="Client: Focus left" { focus-column-left; }
     * Mod+Down hotkey-overlay-title="Client: Focus down" { focus-window-down; }
     * Mod+Up hotkey-overlay-title="Client: Focus up" { focus-window-up; }
     * Mod+Right hotkey-overlay-title="Client: Focus right" { focus-column-right; }
     */

    Mod+Home hotkey-overlay-title="Client: Focus first" { focus-column-first; }
    Mod+End hotkey-overlay-title="Client: Focus last" { focus-column-last; }


    // Client: Move
    Mod+Shift+H hotkey-overlay-title="Client: Move left" { move-column-left; }
    Mod+Shift+J hotkey-overlay-title="Client: Move down" { move-window-down-or-to-workspace-down; }
    Mod+Shift+K hotkey-overlay-title="Client: Move up" { move-window-up-or-to-workspace-up; }
    Mod+Shift+L hotkey-overlay-title="Client: Move right" { move-column-right; }

    /*
     * Mod+Ctrl+Left hotkey-overlay-title="Client: Move left" { move-column-left; }
     * Mod+Ctrl+Down hotkey-overlay-title="Client: Move down" { move-window-down; }
     * Mod+Ctrl+Up hotkey-overlay-title="Client: Move up" { move-window-up; }
     * Mod+Ctrl+Right hotkey-overlay-title="Client: Move right" { move-column-right; }
     */

    Mod+Shift+Home hotkey-overlay-title="Client: Move to first" { move-column-to-first; }
    Mod+Shift+End hotkey-overlay-title="Client: Move to last" { move-column-to-last; }


    // Monitor: Focus
    Mod+Ctrl+H hotkey-overlay-title="Monitor: Focus left" { focus-monitor-left; }
    Mod+Ctrl+J hotkey-overlay-title="Monitor: Focus down" { focus-monitor-down; }
    Mod+Ctrl+K hotkey-overlay-title="Monitor: Focus up" { focus-monitor-up; }
    Mod+Ctrl+L hotkey-overlay-title="Monitor: Focus right" { focus-monitor-right; }

    /*
     * Mod+Ctrl+Left hotkey-overlay-title="Monitor: Focus left" { focus-monitor-left; }
     * Mod+Ctrl+Down hotkey-overlay-title="Monitor: Focus down" { focus-monitor-down; }
     * Mod+Ctrl+Up hotkey-overlay-title="Monitor: Focus up" { focus-monitor-up; }
     * Mod+Ctrl+Right hotkey-overlay-title="Monitor: Focus right" { focus-monitor-right; }
     */


    // Monitor: Move
    Mod+Shift+Ctrl+H hotkey-overlay-title="Monitor: Move left" { move-column-to-monitor-left; }
    Mod+Shift+Ctrl+J hotkey-overlay-title="Monitor: Move down" { move-column-to-monitor-down; }
    Mod+Shift+Ctrl+K hotkey-overlay-title="Monitor: Move up" { move-column-to-monitor-up; }
    Mod+Shift+Ctrl+L hotkey-overlay-title="Monitor: Move right" { move-column-to-monitor-right; }

    /*
     * Mod+Shift+Ctrl+Left hotkey-overlay-title="Monitor: Focus left" { move-column-to-monitor-left; }
     * Mod+Shift+Ctrl+Down hotkey-overlay-title="Monitor: Focus down" { move-column-to-monitor-down; }
     * Mod+Shift+Ctrl+Up hotkey-overlay-title="Monitor: Focus up" { move-column-to-monitor-up; }
     * Mod+Shift+Ctrl+Right hotkey-overlay-title="Monitor: Focus right" { move-column-to-monitor-right; }
     */


    // Workspace: Focus
    Mod+Page_Down hotkey-overlay-title="Workspace: Focus down" { focus-workspace-down; }
    Mod+Page_Up hotkey-overlay-title="Workspace: Focus up" { focus-workspace-up; }

    Mod+Tab hotkey-overlay-title="Workspace: Focus previous" { focus-workspace-previous; }

    Mod+1 { focus-workspace 1; }
    Mod+2 { focus-workspace 2; }
    Mod+3 { focus-workspace 3; }
    Mod+4 { focus-workspace 4; }
    Mod+5 { focus-workspace 5; }
    Mod+6 { focus-workspace 6; }
    Mod+7 { focus-workspace 7; }
    Mod+8 { focus-workspace 8; }
    Mod+9 { focus-workspace 9; }


    // Workspace: Move
    Mod+Shift+1 { move-column-to-workspace 1; }
    Mod+Shift+2 { move-column-to-workspace 2; }
    Mod+Shift+3 { move-column-to-workspace 3; }
    Mod+Shift+4 { move-column-to-workspace 4; }
    Mod+Shift+5 { move-column-to-workspace 5; }
    Mod+Shift+6 { move-column-to-workspace 6; }
    Mod+Shift+7 { move-column-to-workspace 7; }
    Mod+Shift+8 { move-column-to-workspace 8; }
    Mod+Shift+9 { move-column-to-workspace 9; }

    Mod+Ctrl+Alt+H hotkey-overlay-title="Workspace: Move left monitor" { move-workspace-to-monitor-left; }
    Mod+Ctrl+Alt+J hotkey-overlay-title="Workspace: Move down monitor" { move-workspace-to-monitor-down; }
    Mod+Ctrl+Alt+K hotkey-overlay-title="Workspace: Move up monitor" { move-workspace-to-monitor-up; }
    Mod+Ctrl+Alt+L hotkey-overlay-title="Workspace: Move right monitor" { move-workspace-to-monitor-right; }


    // Workspace: Swap
    Mod+Alt+J hotkey-overlay-title="Workspace: Swap down" { move-workspace-down; }
    Mod+Alt+K hotkey-overlay-title="Workspace: Swap up" { move-workspace-up; }

    Mod+Alt+Page_Down hotkey-overlay-title="Workspace: Swap down" { move-workspace-down; }
    Mod+Alt+Page_Up hotkey-overlay-title="Workspace: Swap up" { move-workspace-up; }


    // Workspace: Mouse
    Mod+WheelScrollDown cooldown-ms=50 { focus-column-right; }
    Mod+WheelScrollUp cooldown-ms=50 { focus-column-left; }

    Mod+Shift+WheelScrollDown cooldown-ms=150 { focus-workspace-down; }
    Mod+Shift+WheelScrollUp cooldown-ms=150 { focus-workspace-up; }

    Mod+Shift+Ctrl+WheelScrollDown cooldown-ms=150 { move-column-to-workspace-down; }
    Mod+Shift+Ctrl+WheelScrollUp cooldown-ms=150 { move-column-to-workspace-up; }


    // Layout: Windows
    Mod+BracketLeft hotkey-overlay-title="Layout: Move left" { consume-or-expel-window-left; }
    Mod+BracketRight hotkey-overlay-title="Layout: Move right" { consume-or-expel-window-right; }

    Mod+Ctrl+BracketLeft hotkey-overlay-title="Layout: Consume left" { consume-window-into-column; }
    Mod+Ctrl+BracketRight hotkey-overlay-title="Layout: Expel right" { expel-window-from-column; }

    Mod+Comma hotkey-overlay-title="Layout: Decrease width" { set-column-width "-10%"; }
    Mod+Period hotkey-overlay-title="Layout: Increase width" { set-column-width "+10%"; }
    Mod+Shift+Period hotkey-overlay-title="Layout: Decrease height" { set-window-height "-10%"; }
    Mod+Shift+Comma hotkey-overlay-title="Layout: Increase height" { set-window-height "+10%"; }


    // Layout: Preset
    Mod+R hotkey-overlay-title="Layout: Switch width" { switch-preset-column-width; }
    Mod+Shift+R hotkey-overlay-title="Layout: Switch height" { switch-preset-window-height; }
    Mod+Ctrl+R hotkey-overlay-title="Layout: Reset height" { reset-window-height; }

    Mod+M hotkey-overlay-title="Layout: Maximize column" { maximize-column; }
    Mod+Shift+M hotkey-overlay-title="Layout: Fullscreen window" { fullscreen-window; }
    Mod+Ctrl+F hotkey-overlay-title="Layout: Maximum width" { expand-column-to-available-width; }

    Mod+Z hotkey-overlay-title="Layout: Center column" { center-column; }
    Mod+Ctrl+Z hotkey-overlay-title="Layout: Center all columns" { center-visible-columns; }


    // Layout: Floating and tabs
    Mod+Space hotkey-overlay-title="Layout: Toggle Floating" { toggle-window-floating; }
    Mod+Shift+Space hotkey-overlay-title="Layout: Focus floating" { switch-focus-between-floating-and-tiling; }
    Mod+Ctrl+T hotkey-overlay-title="Layout: Toggle tabbed" { toggle-column-tabbed-display; }


    // Screenshots
    Mod+S hotkey-overlay-title="Screenshot: Select" { screenshot; }
    Mod+Ctrl+S hotkey-overlay-title="Screenshot: Screen" { screenshot-screen; }
    Mod+Alt+S hotkey-overlay-title="Screenshot: Window" { screenshot-window; }

    Print { screenshot; }
    Ctrl+Print { screenshot-screen; }
    Alt+Print { screenshot-window; }


    // Misc
    Ctrl+Alt+Delete { quit; }
    Mod+Shift+P { power-off-monitors; }
    Mod+Escape allow-inhibiting=false { toggle-keyboard-shortcuts-inhibit; }
}

// Window rules
window-rule {
    match app-id=r#"firefox$"# title="^Picture-in-Picture$"
    match app-id=r#"librewolf$"# title="^Picture-in-Picture$"
    open-floating true
}

window-rule {
    match app-id=r#"mpv$"#
    match app-id=r#"vesktop$"#
    default-column-width { proportion 0.66667; }
}

window-rule {
    match app-id=r#"com.github.th_ch.youtube_music"#
    default-column-width { proportion 0.33333; }
}

window-rule {
    match app-id=r#"ibus-ui-gtk3$"# title="^ibus-ui-gtk3$"
    default-floating-position x=810 y=40 relative-to="bottom-right"
    open-floating true
    open-maximized false
    open-focused false

    max-width 300
    max-height 200
}

// Disable unused
hotkey-overlay { skip-at-startup; }
gestures { hot-corners { off; }; }
clipboard { disable-primary; }

// Misc
prefer-no-csd

// Autostart
spawn-at-startup "xwayland-satellite"
spawn-at-startup "waybar"
spawn-at-startup "rofi-polkit-agent"

// For xwayland-satellite
environment {
    DISPLAY ":0"
    XDG_CURRENT_DESKTOP "niri"
    MOZ_ENABLE_WAYLAND "1"
    QT_QPA_PLATFORM "xcb"
    QT_WAYLAND_DISABLE_WINDOWDECORATION "1"
    QT_IM_MODULES "wayland;fcitx;ibus"
}

